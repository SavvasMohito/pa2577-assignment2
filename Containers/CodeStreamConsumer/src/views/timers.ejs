<!DOCTYPE html>
<html>

<head>
	<title>Timers Statistics</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
	<h1>Timers Statistics</h1>
	<p>Total Files: <%= stats_total.totalFiles %>
	</p>
	<h2>Total processing time</h2>
	<p>Average Time per File: <%= (stats_total.averageTime / 1000).toFixed(2) %> µs</p>
	<p>Average Time per Last 100 Files: <%= (stats_total.averageTimeLast100 / 1000).toFixed(2) %> ms</p>
	<p>Average Time per Last 1000 Files: <%= (stats_total.averageTimeLast1000 / 1000).toFixed(2) %> ms</p>

	<h2>Matching time</h2>
	<p>Average Time per File: <%= (stats_match.averageTime / 1000).toFixed(2) %> µs</p>
	<p>Average Time per Last 100 Files: <%= (stats_match.averageTimeLast100 / 1000).toFixed(2) %> ms</p>
	<p>Average Time per Last 1000 Files: <%= (stats_match.averageTimeLast1000 / 1000).toFixed(2) %> ms</p>

	<div style="width: 1000px; height:600px">
		<canvas id="barChart"></canvas>
	</div>

	<div style="width: 1000px; height:600px">
		<canvas id="lineChart"></canvas>
	</div>

	<%-'<script>'%>
		let stats_total = <%-JSON.stringify(stats_total)%>;
		let stats_match = <%-JSON.stringify(stats_match)%>;
	<%-'</script>'%>

	<script>
		const canvas = document.getElementById('barChart')
		const ctx = canvas.getContext('2d');
		const barChart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: ['Average Time per File', 'Average Time per Last 100 Files', 'Average Time per Last 1000 Files'],
				datasets: [{
					label: 'Total processing time (ms)',
					data: [
						(stats_total.averageTime / 1000).toFixed(2),
						(stats_total.averageTimeLast100 / 1000).toFixed(2),
						(stats_total.averageTimeLast1000 / 1000).toFixed(2)
					],
					backgroundColor: 'rgba(75, 192, 192, 0.2)',
					borderColor: 'rgba(75, 192, 192, 1)',
					borderWidth: 1
				}, {
					label: 'Matching time (ms)',
					data: [
						(stats_match.averageTime / 1000).toFixed(2),
						(stats_match.averageTimeLast100 / 1000).toFixed(2),
						(stats_match.averageTimeLast1000 / 1000).toFixed(2)
					],
					backgroundColor: 'rgba(153, 102, 255, 0.2)',
					borderColor: 'rgba(153, 102, 255, 1)',
					borderWidth: 1
				}]
			},
			options: {
				responsive: true,
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});

		const lineCanvas = document.getElementById('lineChart');
		const lineCtx = lineCanvas.getContext('2d');
		const lineChart = new Chart(lineCtx, {
			type: 'line',
			data: {
				labels: Array.from({ length: stats_total.last100.length }, (_, i) => i + 1),
				datasets: [{
					label: 'Total Time (ms)',
					data: stats_total.last100.map(time => (time / 1000).toFixed(2)),
					
					borderColor: 'rgba(75, 192, 192, 1)',
					backgroundColor: 'rgba(75, 192, 192, 0.2)',
					fill: false
				}, {
					label: 'Match Time (ms)',
					data: stats_match.last100.map(time => (time / 1000).toFixed(2)),
					borderColor: 'rgba(153, 102, 255, 1)',
					backgroundColor: 'rgba(153, 102, 255, 0.2)',
					fill: false
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});
	</script>
</body>

</html>